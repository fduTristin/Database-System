{% extends 'front/base.html' %}
{% load static %}

{% block title %}
    创建订单
{% endblock %}

{% block custom_style %}

{% endblock %}

{% block custom_content %}
    <div class="container-fluid">
        <div class="row mb-3">
            <div class="col-6">
                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#select-book-modal"
                        id="select-book-button">
                    从库存中选择
                </button>
            </div>
        </div>
        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col">

                <div class="table-responsive">
                    <table class="table">
                        <thead>
                        <tr>
                            <th scope="col">书名</th>
                            <th scope="col">格式</th>
                            <th scope="col">当前库存数量</th>
                            <th scope="col">数量</th>
                            <th scope="col">价格</th>
                        </tr>
                        </thead>
                        <tbody id="books-list"></tbody>
                    </table>
                </div>

                <div class="card shadow-2-strong mb-5 mb-lg-0" style="border-radius: 16px;">
                    <div class="card-body p-4">
                        <div class="row">
                            <div class="col-md-6 col-lg-4 col-xl-3 mb-4 mb-md-0">
                                <form>
                                    <div class="d-flex flex-row pb-3">
                                        <div class="d-flex align-items-center pe-2">
                                            <input class="form-check-input" type="radio" name="radioNoLabel"
                                                   value="" aria-label="..." id="salesRadio"
                                                   onchange="changeOrderType();"/>
                                        </div>
                                        <div class="rounded border w-100 p-3">
                                            <p class="d-flex align-items-center mb-0">
                                                <i class="fa-solid fa-arrow-right-from-bracket fa-2x fa-lg text-dark pe-2"></i>&nbsp;&nbsp;销售订单
                                            </p>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="col-md-6 col-lg-4 col-xl-6">
                                <div class="row">
                                    <div class="col-12 col-xl-6">
                                        <div class="form-outline mb-4 mb-xl-5">
                                            <textarea class="form-control" id="order-notes" rows="3"></textarea>
                                            <label class="form-label" for="typeName">订单备注</label>
                                        </div>
                                    </div>
                                    <div class="col-12 col-xl-6" id="custom-info-col" hidden="hidden">
                                        <div class="form-outline mb-4 mb-xl-5">
                                            <textarea class="form-control" id="custom-info" rows="3"></textarea>
                                            <label class="form-label" for="typeName">客户信息</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4 col-xl-3">
                                <div class="d-flex justify-content-between" style="font-weight: 500;">
                                    <p class="mb-2">商品总价</p>
                                    <p class="mb-2" id="item_price">￥0</p>
                                </div>

                                <div class="d-flex justify-content-between" style="font-weight: 500;">
                                    <p class="mb-0">其他费用</p>
                                    <p class="mb-0" id="oth-price">￥0</p>
                                </div>

                                <hr class="my-4">

                                <div class="d-flex justify-content-between mb-4" style="font-weight: 500;">
                                    <p class="mb-2">订单总价格</p>
                                    <p class="mb-2" id="total_price">￥0</p>
                                </div>

                                <button type="button" class="btn btn-primary btn-block btn-lg" onclick="submitOrder()">
                                    <div class="d-flex justify-content-between">
                                        <span>提交订单</span>
                                        <span id="checkout_price">￥0</span>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="add-book-modal" tabindex="-1" aria-labelledby="add-book-modal-label"
                 aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-body">
                            <form id="new-book">
                                <div class="row">
                                    <div class="col-6">
                                        <div class="form-group">
                                            <label for="book-image-input">封面</label>
                                            <input type="file" accept="image/*" class="form-control"
                                                   name="book-image-input" id="book-image-input">
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="form-group">
                                            <label for="book-name-input">书名</label>
                                            <input type="text" class="form-control" name="book-name-input" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <div class="form-group">
                                            <label for="book-isbn-input">ISBN</label>
                                            <input type="text" class="form-control" name="book-isbn-input" required>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="form-group">
                                            <label for="book-author-input">作者</label>
                                            <input type="text" class="form-control" name="book-author-input" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <div class="form-group">
                                            <label for="book-publisher-input">出版社</label>
                                            <input type="text" class="form-control" name="book-publisher-input"
                                                   required>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="form-group">
                                            <label for="book-price-input">零售价</label>
                                            <input type="number" min="0" class="form-control" name="book-price-input"
                                                   required>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <div class="form-group">
                                            <label for="book-genre-input">内容体裁</label>
                                            <input type="text" class="form-control" name="book-genre-input" required>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="form-group">
                                            <label for="book-format-input">书籍格式</label>
                                            <input type="text" class="form-control" name="book-format-input" required>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="select-book-modal" tabindex="-1" aria-labelledby="select-book-modal-label"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="add-book-modal-label">选择</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="form-group">
                                <label for="book-picker">库存列表</label>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                                    </div>
                                    <input type="text" class="form-control" id="book-search" placeholder="搜索书名"
                                           onkeyup="filterBooks()">
                                </div>
                                <div class="row mt-3" id="book-image-container">
                                </div>
                                <div class="mt-3">
                                    <nav>
                                        <ul class="pagination justify-content-center" id="pagination-container">
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="confirm-book-modal" tabindex="-1" aria-labelledby="select-book-modal-label"
             aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">书籍信息</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-4">
                                <img src="" class="img-fluid" alt="Book Cover" id="confirm-img">
                            </div>
                            <div class="col-md-8">
                                <h5 id="confirm-bookname">Book Name</h5>
                                <p>作者: <strong id="confirm-author">Author Name</strong></p>
                                <p>出版社: <strong id="confirm-publisher">Publisher Name</strong></p>
                                <p>书籍格式: <strong id="confirm-format">Book Format</strong></p>
                                <p>零售价: <strong id="confirm-rprice">$XX.XX</strong></p>
                                <p>库存数量: <strong id="confirm-stock">XX</strong></p>
                                <p>ISBN: <strong id="confirm-isbn">123456789</strong></p>
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-success" onclick="selectBook()" id="confirm-button">
                            选择
                        </button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                    </div>
                </div>
            </div>
        </div>

    </div>
{% endblock %}

{% block custom_js %}
    <script>
        const stock_url = "{% url 'backend:books_for_order' %}";
        const order_url = "{% url 'backend:create_order' %}";
        const addBookApi = "{% url 'backend:add_book' %}";
    </script>
    <script src="{% static 'front/js/make-orders.min.js' %}"></script>
{% endblock %}